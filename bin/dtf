#!/usr/bin/env ruby
#
# This is the master script to be used to manage the various Verification Suites,
# Analysis Cases, and Case Tests
#
# Ex: dtf create_user -u|--user @user_name -n|--name "John Public" -e|--email
# "j@public.com"
#
# -u -n and -e are _required_ parameters
#
# Accessing the help system
# Ex: dtf help create_user

require 'dtf'
require 'trollop' # Used to implement help system

SUB_COMMANDS = %w(create_user create_vs delete_user delete_vs)

# Global options default to '--version|-v' and '--help|-h'
global_opts = Trollop::options do
  version "DTF v#{Dtf::VERSION}
Copyright (c) 2012, David Deryl Downey / Deryl R. Doucette.
This is free software; see the LICENSE file for copying conditions.
There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE."

  banner <<-EOS
  #{version}
  
  Usage:
        dtf -v|--version -h|--help [[sub_cmds <options>] -h|--help]
  
  Valid [sub_cmds] are: create_(user|vs), delete_(user|vs)
  See 'dtf [sub_cmd] -h' for each sub_cmd's details and options
    
EOS
  stop_on SUB_COMMANDS
end

# Sub-commands go here
cmd = ARGV.shift
cmd_opts = case cmd
  when "create_user"
    Trollop::options do
      opt(:user, desc="Username for new TF user - REQUIRED", opts={:type => :string, :short => '-u'})
      opt(:name, desc="Real name for new TF user - REQUIRED", opts={:type => :string, :short => '-n'})
      opt(:email, desc="Email address for new TF user - REQUIRED", opts={:type => :string, :short => '-e'})
    end
  when "create_vs"
    Trollop::options do
      opt(:user, desc="TF user to associate this VS with - REQUIRED", opts={:type => :string, :short => '-u'})
      opt(:name, desc="Descriptive name for new VS - REQUIRED", opts={:type => :string, :short => '-n'})      
    end
  when "delete_user"
    Trollop::options do
      opt(:user, desc="Username of TF user to delete - REQUIRED", opts={:type => :string, :short => '-u'})
      opt(:delete_all, desc="Delete _all_ VSs this user owns", :type => :flag, :default => true)
    end
  when "delete_vs"
    Trollop::options do
      opt(:user, desc="Username of VS owner - REQUIRED", opts={:type => :string, :short => '-u'})
      opt(:id, desc="ID of VS to be deleted - REQUIRED", opts={:type => :int, :short => '-i'})
    end
  when nil
    Trollop::die "No command specified"
  else
    Trollop::die "Unknown sub-command: #{cmd.inspect}"
  end
